<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Pacman 2</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <script>
            var arrayMapa = [["x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", " ", "x", "x"],
                ["x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x", " ", " ", " ", " ", "x", " ", "x", "x", "x", "x", "x", " ", "x", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", " ", "x", " ", " ", " ", " ", " ", " ", " ", "x", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", " ", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", " ", " ", " ", " ", " ", " ", " ", "x", "x", "x", " ", " ", " ", " ", "x", " ", " ", " ", " ", "x", " ", " ", " ", " ", " ", " ", " ", " ", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", " ", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x", "x", "x", "x", "x", "x", "x", "x", "x", " ", " ", " ", " ", " ", " ", " ", " ", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x", "x", "x", "x", "x", "x", "x", "x"],
                ["x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x", "x", "x", "x", "x", "x", "x", "x", " ", " ", " ", " ", " ", " ", " ", " ", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", " ", "x", "x", "x", "x", "x"],
                ["x", " ", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", " ", "x", "x", "x", "x", "x"],
                ["x", " ", " ", " ", " ", " ", "x", " ", " ", " ", " ", "x", " ", "x", "x", "x", " ", " ", " ", " ", " ", " ", "x", "x", " ", " ", " ", " ", " ", "x"],
                ["x", "x", "x", "x", "x", " ", "x", " ", "x", "x", " ", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x"],
                ["x", "x", "x", "x", "x", " ", "x", " ", "x", "x", " ", "x", " ", "x", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x"],
                ["x", " ", " ", " ", " ", " ", " ", " ", "x", "x", " ", " ", " ", " ", "x", "x", " ", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", "x", "x", "x"],
                ["x", " ", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", " ", "x", "x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x"],
                ["x", " ", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", " ", "x", "x", " ", "x", "x", " ", "x", "x", "x", "x", " ", "x", "x", "x", " ", "x"],
                ["x", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "x"],
                ["x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x"]];
            var jugador = new Array(4);
            var fantasma1 = new Array(3);
            var fantasma2 = new Array(3);
            var fantasma3 = new Array(3);
            var direccionJugador = 0;
            jugador = ubicarPersonajes(jugador);
            fantasma1 = ubicarPersonajes(fantasma1);
            fantasma2 = ubicarPersonajes(fantasma2);
            fantasma3 = ubicarPersonajes(fantasma3);
            cargarMapa();
            var movimiento = setInterval(function () {
                if(comprobarSiPuedeIrEnLaDireccionPulsada()==true){
                    jugador[2]=direccionJugador;
                }
                jugador = moverPersonajes(jugador);
                comprobarColision(jugador);
                fantasma1 = moverPersonajes(fantasma1);
                comprobarColision(jugador);
                fantasma2 = moverPersonajes(fantasma2);
                comprobarColision(jugador);
                fantasma3 = moverPersonajes(fantasma3);
                comprobarColision(jugador);
                borrarBody();
                document.body.addEventListener("keydown", function (event) {
                    direccionJugador = event.key;
                }, false);
                cargarMapa();
            }, 1000);
            function cargarMapa() {
                document.write("<h1>PACMAN 2</h1>");
                arrayMapa[fantasma1[0]][fantasma1[1]] = "P";
                arrayMapa[fantasma2[0]][fantasma2[1]] = "P";
                arrayMapa[fantasma3[0]][fantasma3[1]] = "P";
                arrayMapa[jugador[0]][jugador[1]] = "J";
                for (var vertical = 0; vertical < arrayMapa.length; vertical++) {
                    for (var horizontal = 0; horizontal < arrayMapa[vertical].length; horizontal++) {
                        if (arrayMapa[vertical][horizontal] == ' ') {
                            document.write("#" + " ");
                        } else {
                            if (arrayMapa[vertical][horizontal] == "P") {
                                document.write(" ");
                            }
                            if (arrayMapa[vertical][horizontal] == "J") {
                                document.write(" ");
                            }
                            document.write(arrayMapa[vertical][horizontal] + " ");
                        }
                    }
                    document.write("<br>")
                }
                document.write("<br>");
                document.write("Fantasma 1 va: " + fantasma1[2] + "<br>");
                document.write("Fantasma 2 va: " + fantasma2[2] + "<br>");
                document.write("Fantasma 3 va: " + fantasma3[2] + "<br>");
                document.write("Jugador va: " + jugador[2] + "<br>");
                document.write("Jugador quiere ir en" + jugador[3]);
            }
            function ubicarPersonajes(personaje) {
                var vertical = 0;
                var auxiliarVertical = 0;
                var horizontal = 0;
                var auxiliarHorizontal = 0;
                var direccion = 0;
                do {
                    vertical = aleatorio(0, 29);
                    horizontal = aleatorio(0, 29);
                } while (arrayMapa[vertical][horizontal] != " ");
                do {
                    auxiliarVertical = vertical;
                    auxiliarHorizontal = horizontal;
                    direccion = aleatorio(1, 4);
                    switch (direccion) {
                        case 1:
                            auxiliarHorizontal -= 1;
                            break;
                        case 2:
                            auxiliarVertical += 1;
                            break;
                        case 3:
                            auxiliarHorizontal += 1;
                            break;
                        case 4:
                            auxiliarVertical -= 1;
                            break;
                    }
                } while (arrayMapa[auxiliarVertical][auxiliarHorizontal] != " ");
                if (personaje.length < 4) {
                    personaje = [vertical, horizontal, direccion];
                } else {
                    personaje = [vertical, horizontal, direccion, 0]
                }
                return personaje;
            }
            function aleatorio(min, max) {
                return Math.floor(Math.random() * (max - min)) + min;
            }
            function moverPersonajes(personaje) {
                var auxiliarVertical2 = personaje[0];
                var auxiliarHorizontal2 = personaje[1];
                direccion=personaje[2];
                switch (direccion) {
                    case 1:
                        auxiliarHorizontal2 -= 1;
                        break;
                    case 2:
                        auxiliarVertical2 += 1;
                        break;
                    case 3:
                        auxiliarHorizontal2 += 1;
                        break;
                    case 4:
                        auxiliarVertical2 -= 1;
                        break;
                }
                if (arrayMapa[auxiliarVertical2][auxiliarHorizontal2] != "x") {
                    if (personaje.length < 4) {
                        arrayMapa[personaje[0]][personaje[1]] = " ";
                        personaje = [auxiliarVertical2, auxiliarHorizontal2, direccion];
                    } else {
                        arrayMapa[personaje[0]][personaje[1]] = " ";
                        personaje = [auxiliarVertical2, auxiliarHorizontal2, direccion, personaje[3]];
                    }
                } else {
                    do {
                        auxiliarVertical2 = personaje[0];
                        auxiliarHorizontal2 = personaje[1];
                        direccion=aleatorio(1,5);
                        switch (direccion) {
                            case 1:
                                auxiliarHorizontal2 -= 1;
                                break;
                            case 2:
                                auxiliarVertical2 += 1;
                                break;
                            case 3:
                                auxiliarHorizontal2 += 1;
                                break;
                            case 4:
                                auxiliarVertical2 -= 1;
                                break;
                        }
                    } while (arrayMapa[auxiliarVertical2][auxiliarHorizontal2] == "x");
                    if (personaje.length < 4) {
                        arrayMapa[personaje[0]][personaje[1]] = " ";
                        personaje = [auxiliarVertical2, auxiliarHorizontal2, direccion];
                    } else {
                        direccionJugador=direccion;
                        arrayMapa[personaje[0]][personaje[1]] = " ";
                        personaje = [auxiliarVertical2, auxiliarHorizontal2, direccion, personaje[3]];
                    }
                }
                return personaje;
            }
            function comprobarColision(colisionador) {
                if (arrayMapa[colisionador[0]][colisionador[1]] == "P") {
                    alert("Colision detectada");
                }

            }
            function borrarBody() {
                document.body.innerHTML = "";
            }
            function comprobarSiPuedeIrEnLaDireccionPulsada() {
                var verticalJugador = jugador[0];
                var horizontalJugador = jugador[1];
                switch (direccionJugador) {
                    case "ArrowUp":
                        direccionJugador = 4;
                        verticalJugador += 1;
                        break;
                    case "ArrowDown":
                        direccionJugador = 2;
                        verticalJugador -= 1;
                        break;
                    case "ArrowLeft":
                        direccionJugador = 1;
                        horizontalJugador -= 1;
                        break;
                    case "ArrowRight":
                        direccionJugador = 3;
                        horizontalJugador += 1;
                        break;
                }
                if (arrayMapa[verticalJugador][horizontalJugador] != "x") {
                    jugador[3]=direccionJugador;
                    return true;
                } else {
                    jugador[3]=direccionJugador;
                    return false;
                }
            }


        </script>
    </body>
</html>
